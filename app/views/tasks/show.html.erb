<!-- app/views/tasks/show.html.erb -->

<h1><%= @task.title %></h1>

<p>
  Description: <%= @task.description %><br>
  Budget: <%= @task.budget %><br>
  Category: <%= @task.category %><br>
  Deadline: <%= @task.deadline %><br>
  Status: <%= @task.status %>
</p>

<% if current_user == @task.client %>
  <% if @task.completed? %>
    <% if @task.completed_file.attached? %>
      <p>
        Completed file: <%= link_to @task.completed_file.filename, rails_blob_path(@task.completed_file, disposition: "attachment") %>
      </p>
    <% end %>
    <!-- Change request form -->
    <%= form_with model: @task, url: request_changes_task_path(@task), method: :post do |form| %>
      <%= form.label :change_request, "Request Changes:" %>
      <%= form.text_area :change_request, required: true %>
      <%= form.submit 'Submit Request', class: 'btn btn-warning' %>
    <% end %>
  <% else %>
    <%= link_to 'Edit', edit_task_path(@task), class: 'btn btn-secondary' %> |
  <% end %>
<% elsif current_user.freelancer? %>
  <% if @task.open? %>
    <%= form_with url: accept_task_path(@task), method: :post do %>
      <%= submit_tag 'Accept', class: 'btn btn-primary' %>
    <% end %>
  <% elsif @task.in_progress? && @task.freelancer == current_user %>
    <%= form_with url: complete_task_path(@task), method: :post, html: { multipart: true } do |form| %>
      <%= form.file_field :completed_file %>
      <%= form.submit 'Submit Task', class: 'btn btn-primary' %>
    <% end %>
  <% end %>
<% end %>

<%= link_to 'Back', tasks_path, class: 'btn btn-secondary' %>
